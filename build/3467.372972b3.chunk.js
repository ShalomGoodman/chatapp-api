"use strict";(self.webpackChunkchatapp=self.webpackChunkchatapp||[]).push([[3467],{49699:(B,P,e)=>{e.d(P,{Z:()=>R});var t=e(67294),M=e(53979),u=e(11047),i=e(29728),s=e(57993),a=e(85018),c=e(67109),g=e(45697),n=e.n(g),v=e(86896),E=e(30815),l=e(14900);const o=({onRegenerate:p,idToRegenerate:m,backUrl:C,onError:x})=>{const{formatMessage:r}=(0,v.Z)(),[W,S]=(0,t.useState)(!1),{regenerateData:Z,isLoadingConfirmation:N}=(0,l.rW)(C,m,p,x),L=async()=>{Z(),S(!1)};return t.createElement(t.Fragment,null,t.createElement(i.z,{startIcon:t.createElement(E.Z,null),type:"button",size:"S",variant:"tertiary",onClick:()=>S(!0),name:"regenerate"},r({id:"Settings.tokens.regenerate",defaultMessage:"Regenerate"})),t.createElement(s.QH,{bodyText:{id:"Settings.tokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:t.createElement(E.Z,null),isConfirmButtonLoading:N,isOpen:W,onToggleDialog:()=>S(!1),onConfirm:L,leftButtonText:{id:"Settings.tokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.tokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.tokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};o.defaultProps={onRegenerate(){},onError:void 0},o.propTypes={onRegenerate:n().func,idToRegenerate:n().oneOfType([n().number,n().string]).isRequired,backUrl:n().string.isRequired,onError:n().func};const T=o,y=({title:p,token:m,setToken:C,canEditInputs:x,canRegenerate:r,isSubmitting:W,backUrl:S,regenerateUrl:Z,onErrorRegenerate:N})=>{const{formatMessage:L}=(0,v.Z)(),X=j=>{C({...m,accessKey:j})};return t.createElement(M.T,{title:(m==null?void 0:m.name)||L(p),primaryAction:x?t.createElement(u.k,{gap:2},r&&(m==null?void 0:m.id)&&t.createElement(T,{backUrl:Z,onRegenerate:X,idToRegenerate:m==null?void 0:m.id,onError:N}),t.createElement(i.z,{disabled:W,loading:W,startIcon:t.createElement(a.Z,null),type:"submit",size:"S"},L({id:"global.save",defaultMessage:"Save"}))):r&&(m==null?void 0:m.id)&&t.createElement(T,{onRegenerate:X,idToRegenerate:m==null?void 0:m.id,backUrl:Z}),navigationAction:t.createElement(s.rU,{startIcon:t.createElement(c.Z,null),to:S},L({id:"global.back",defaultMessage:"Back"})),ellipsis:!0})};y.propTypes={token:n().shape({id:n().oneOfType([n().number,n().string]),type:n().string,lifespan:n().oneOfType([n().number,n().string]),name:n().string,accessKey:n().string,permissions:n().array,description:n().string,createdAt:n().string}),canEditInputs:n().bool.isRequired,canRegenerate:n().bool.isRequired,setToken:n().func.isRequired,isSubmitting:n().bool.isRequired,backUrl:n().string.isRequired,title:n().shape({id:n().string,label:n().string}).isRequired,regenerateUrl:n().string.isRequired,onErrorRegenerate:n().func},y.defaultProps={token:void 0,onErrorRegenerate:void 0};const R=y},89982:(B,P,e)=>{e.d(P,{Z:()=>v});var t=e(67294),M=e(40619),u=e(82562),i=e(75515),s=e(45697),a=e.n(s),c=e(86896),g=e(51352);const n=({token:E,errors:l,values:o,onChange:T,isCreating:y})=>{var R;const{formatMessage:p}=(0,c.Z)();return t.createElement(t.Fragment,null,t.createElement(M.P,{name:"lifespan",label:p({id:"Settings.tokens.form.duration",defaultMessage:"Token duration"}),value:o.lifespan!==null?o.lifespan:"0",error:l.lifespan?p((R=l.lifespan)!=null&&R.id?l.lifespan:{id:l.lifespan,defaultMessage:l.lifespan}):null,onChange:m=>{T({target:{name:"lifespan",value:m}})},required:!0,disabled:!y,placeholder:"Select"},t.createElement(u.W,{value:"604800000"},p({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),t.createElement(u.W,{value:"2592000000"},p({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),t.createElement(u.W,{value:"7776000000"},p({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),t.createElement(u.W,{value:"0"},p({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),t.createElement(i.Z,{variant:"pi",textColor:"neutral600"},!y&&`${p({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,g.IX)(E==null?void 0:E.createdAt,parseInt(o.lifespan,10))}`))};n.propTypes={errors:a().shape({lifespan:a().string}),onChange:a().func.isRequired,values:a().shape({lifespan:a().oneOfType([a().number,a().string])}).isRequired,isCreating:a().bool.isRequired,token:a().shape({id:a().oneOfType([a().number,a().string]),type:a().string,lifespan:a().string,name:a().string,accessKey:a().string,permissions:a().array,description:a().string,createdAt:a().string})},n.defaultProps={errors:{},token:{}};const v=n},81384:(B,P,e)=>{e.d(P,{Z:()=>v});var t=e(67294),M=e(12028),u=e(57993),i=e(65186),s=e(69427),a=e(45697),c=e.n(a),g=e(86896);const n=({token:E,tokenType:l})=>{const{formatMessage:o}=(0,g.Z)(),T=(0,u.lm)(),{trackUsage:y}=(0,u.rS)(),{copy:R}=(0,u.VP)(),p=m=>async()=>{await R(m)&&(y("didCopyTokenKey",{tokenType:l}),T({type:"success",message:{id:"Settings.tokens.notification.copied"}}))};return t.createElement(u.Y_,{endAction:E&&t.createElement("span",{style:{alignSelf:"start"}},t.createElement(M.h,{label:o({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),onClick:p(E),noBorder:!0,icon:t.createElement(i.Z,null),style:{padding:0,height:"1rem"}})),title:E||o({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:o(E?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:t.createElement(s.Z,null),iconBackground:"neutral100"})};n.defaultProps={token:null},n.propTypes={token:c().string,tokenType:c().string.isRequired};const v=n},37651:(B,P,e)=>{e.d(P,{Z:()=>c});var t=e(67294),M=e(61467),u=e(45697),i=e.n(u),s=e(86896);const a=({errors:g,values:n,onChange:v,canEditInputs:E})=>{var l;const{formatMessage:o}=(0,s.Z)();return t.createElement(M.g,{label:o({id:"Settings.tokens.form.description",defaultMessage:"Description"}),id:"description",error:g.description?o((l=g.description)!=null&&l.id?g.description:{id:g.description,defaultMessage:g.description}):null,onChange:v,disabled:!E},n.description)};a.propTypes={errors:i().shape({description:i().string}),onChange:i().func.isRequired,canEditInputs:i().bool.isRequired,values:i().shape({description:i().string}).isRequired},a.defaultProps={errors:{}};const c=a},72028:(B,P,e)=>{e.d(P,{Z:()=>c});var t=e(67294),M=e(16364),u=e(45697),i=e.n(u),s=e(86896);const a=({errors:g,values:n,onChange:v,canEditInputs:E})=>{var l;const{formatMessage:o}=(0,s.Z)();return t.createElement(M.o,{name:"name",error:g.name?o((l=g.name)!=null&&l.id?g.name:{id:g.name,defaultMessage:g.name}):null,label:o({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:v,value:n.name,disabled:!E,required:!0})};a.propTypes={errors:i().shape({name:i().string}),onChange:i().func.isRequired,canEditInputs:i().bool.isRequired,values:i().shape({name:i().string}).isRequired},a.defaultProps={errors:{}};const c=a},32381:(B,P,e)=>{e.d(P,{Z:()=>g});var t=e(67294),M=e(40619),u=e(82562),i=e(45697),s=e.n(i),a=e(86896);const c=({name:n,errors:v,values:E,onChange:l,canEditInputs:o,options:T,label:y})=>{var R;const{formatMessage:p}=(0,a.Z)();return t.createElement(M.P,{name:n,label:p({id:y.id,defaultMessage:y.defaultMessage}),value:E&&E[n],error:v[n]?p((R=v[n])!=null&&R.id?v[n]:{id:v[n],defaultMessage:v[n]}):null,onChange:l,placeholder:"Select",required:!0,disabled:!o},T&&T.map(({value:m,label:C})=>t.createElement(u.W,{key:m,value:m},p(C))))};c.propTypes={name:s().string,options:s().arrayOf(s().shape({label:s().shape({id:s().string,defaultMessage:s().string}),value:s().string})),errors:s().shape({type:s().string}),onChange:s().func.isRequired,canEditInputs:s().bool.isRequired,values:s().shape({type:s().string}).isRequired,label:s().shape({id:s().string,defaultMessage:s().string}).isRequired},c.defaultProps={name:"type",errors:{},options:[]};const g=c},81966:(B,P,e)=>{e.d(P,{Z:()=>t,f:()=>M});const t="api-token",M="transfer-token"},51352:(B,P,e)=>{e.d(P,{IX:()=>s,fK:()=>n,mk:()=>E});var t=e(66115),M=e(77349),u=e(51991);const s=(l,o,T="en")=>{if(o&&typeof o=="number"){const y=o/24/60/60/1e3;return(0,t.Z)((0,M.Z)(new Date(l),y),"PPP",{locale:u[T]})}return"Unlimited"};var a=e(57993),c=e(87561);const n=c.Ry().shape({name:c.Z_(a.I0.string).max(100).required(a.I0.required),type:c.Z_(a.I0.string).oneOf(["read-only","full-access","custom"]).required(a.I0.required),description:c.Z_().nullable(),lifespan:c.Rx().integer().min(0).nullable().defined(a.I0.required)}),E=l=>{const o={allActionsIds:[],permissions:[]};return o.permissions=Object.keys(l).map(T=>({apiId:T,label:T.split("::")[1],controllers:Object.keys(l[T].controllers).map(y=>({controller:y,actions:l[T].controllers[y].map(R=>{const p=`${T}.${y}.${R}`;return T.includes("api::")&&o.allActionsIds.push(p),{action:R,actionId:p}}).flat()})).flat()})),o}},43467:(B,P,e)=>{e.d(P,{Z:()=>ue});var t=e(67294),M=e(185),u=e(49066),i=e(11047),s=e(57993),a=e(41054),c=e(86896),g=e(88767),n=e(86706),v=e(16550),E=e(25804),l=e(36364),o=e(81966),T=e(49699),y=e(81384),R=e(41580),p=e(75515),m=e(11276),C=e(67819),x=e(45697),r=e.n(x),W=e(89982),S=e(37651),Z=e(72028),N=e(32381);const L=({errors:k,onChange:I,canEditInputs:F,isCreating:Y,values:O,transferToken:V})=>{const{formatMessage:d}=(0,c.Z)(),$=[{value:"push",label:{id:"Settings.transferTokens.types.push",defaultMessage:"Push"}},{value:"pull",label:{id:"Settings.transferTokens.types.pull",defaultMessage:"Pull"}},{value:"push-pull",label:{id:"Settings.transferTokens.types.push-pull",defaultMessage:"Full Access"}}];return t.createElement(R.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(i.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(p.Z,{variant:"delta",as:"h2"},d({id:"global.details",defaultMessage:"Details"})),t.createElement(m.r,{gap:5},t.createElement(C.P,{key:"name",col:6,xs:12},t.createElement(Z.Z,{errors:k,values:O,canEditInputs:F,onChange:I})),t.createElement(C.P,{key:"description",col:6,xs:12},t.createElement(S.Z,{errors:k,values:O,canEditInputs:F,onChange:I})),t.createElement(C.P,{key:"lifespan",col:6,xs:12},t.createElement(W.Z,{isCreating:Y,errors:k,values:O,onChange:I,token:V})),t.createElement(C.P,{key:"permissions",col:6,xs:12},t.createElement(N.Z,{name:"permissions",values:O,errors:k,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:Q=>{I({target:{name:"permissions",value:Q}})},options:$,canEditInputs:F})))))};L.propTypes={errors:r().shape({name:r().string,description:r().string,lifespan:r().string,type:r().string}),onChange:r().func.isRequired,canEditInputs:r().bool.isRequired,values:r().shape({name:r().string,description:r().string,lifespan:r().oneOfType([r().number,r().string]),type:r().string}).isRequired,isCreating:r().bool.isRequired,transferToken:r().shape({id:r().oneOfType([r().number,r().string]),type:r().string,lifespan:r().string,name:r().string,accessKey:r().string,permissions:r().array,description:r().string,createdAt:r().string})},L.defaultProps={errors:{},transferToken:{}};const X=L;var j=e(53979),re=e(29728),ie=e(85018);const G=({transferTokenName:k})=>{const{formatMessage:I}=(0,c.Z)();return(0,s.go)(),t.createElement(M.o,{"aria-busy":"true"},t.createElement(s.SL,{name:"Transfer Tokens"}),t.createElement(j.T,{primaryAction:t.createElement(re.z,{disabled:!0,startIcon:t.createElement(ie.Z,null),type:"button",size:"L"},I({id:"global.save",defaultMessage:"Save"})),title:k||I({id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"})}),t.createElement(u.D,null,t.createElement(s.dO,null)))};G.defaultProps={transferTokenName:null},G.propTypes={transferTokenName:r().string};const le=G;var _=e(87561);const de=_.Ry().shape({name:_.Z_(s.I0.string).max(100).required(s.I0.required),description:_.Z_().nullable(),lifespan:_.Rx().integer().min(0).nullable().defined(s.I0.required),permissions:_.Z_(s.I0.string).required(s.I0.required)}),ce="Name already taken",ue=()=>{var k;(0,s.go)();const{formatMessage:I}=(0,c.Z)(),{lockApp:F,unlockApp:Y}=(0,s.o1)(),O=(0,s.lm)(),V=(0,v.k6)(),[d,$]=(0,t.useState)((k=V.location.state)!=null&&k.transferToken.accessKey?{...V.location.state.transferToken}:null),{trackUsage:Q}=(0,s.rS)(),J=(0,t.useRef)(Q),{setCurrentStep:ge}=(0,s.c1)(),pe=(0,n.v9)(l._),{allowedActions:{canCreate:me,canUpdate:fe,canRegenerate:Ee}}=(0,s.ss)(pe.settings["transfer-tokens"]),{params:{id:H}}=(0,v.$B)("/settings/transfer-tokens/:id"),{get:ve,post:Te,put:ye}=(0,s.kY)(),D=H==="create",{formatAPIError:b}=(0,s.So)();(0,t.useEffect)(()=>{J.current(D?"didAddTokenFromList":"didEditTokenFromList",{tokenType:o.f})},[D]);const{status:Me}=(0,g.useQuery)(["transfer-token",H],async()=>{const{data:{data:f}}=await ve(`/admin/transfer/tokens/${H}`);return $({...f}),f},{enabled:!D&&!d,onError(f){var A;((A=f.response.data.error.details)==null?void 0:A.code)==="INVALID_TOKEN_SALT"?O({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):O({type:"warning",message:b(f)})}}),Pe=async(f,A)=>{var K,U,z,w,ee,te,ne,se,ae;J.current(D?"willCreateToken":"willEditToken",{tokenType:o.f}),F();const Oe=f.lifespan&&parseInt(f.lifespan,10)&&f.lifespan!=="0"?parseInt(f.lifespan,10):null,oe=f.permissions.split("-");try{const{data:{data:h}}=D?await Te("/admin/transfer/tokens",{...f,lifespan:Oe,permissions:oe}):await ye(`/admin/transfer/tokens/${H}`,{name:f.name,description:f.description,permissions:oe});Y(),D&&(V.replace(`/settings/transfer-tokens/${h.id}`,{transferToken:h}),ge("transferTokens.success")),$({...h}),O({type:"success",message:I(D?{id:"notification.success.transfertokencreated",defaultMessage:"Transfer Token successfully created"}:{id:"notification.success.transfertokenedited",defaultMessage:"Transfer Token successfully edited"})}),J.current(D?"didCreateToken":"didEditToken",{type:d==null?void 0:d.permissions,tokenType:o.f})}catch(h){const De=(0,E.Iz)(h.response.data);A.setErrors(De),((z=(U=(K=h==null?void 0:h.response)==null?void 0:K.data)==null?void 0:U.error)==null?void 0:z.message)===ce?O({type:"warning",message:h.response.data.message||"notification.error.tokennamenotunique"}):((ne=(te=(ee=(w=h==null?void 0:h.response)==null?void 0:w.data)==null?void 0:ee.error)==null?void 0:te.details)==null?void 0:ne.code)==="INVALID_TOKEN_SALT"?O({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):O({type:"warning",message:((ae=(se=h==null?void 0:h.response)==null?void 0:se.data)==null?void 0:ae.message)||"notification.error"}),Y()}},q=fe&&!D||me&&D;if(!D&&!d&&Me!=="success")return t.createElement(le,{transferTokenName:d==null?void 0:d.name});const Re=f=>{var A,K,U,z;((z=(U=(K=(A=f==null?void 0:f.response)==null?void 0:A.data)==null?void 0:K.error)==null?void 0:U.details)==null?void 0:z.code)==="INVALID_TOKEN_SALT"?O({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):O({type:"warning",message:b(f)})};return t.createElement(M.o,null,t.createElement(s.SL,{name:"Transfer Tokens"}),t.createElement(a.J9,{validationSchema:de,validateOnChange:!1,initialValues:{name:(d==null?void 0:d.name)||"",description:(d==null?void 0:d.description)||"",lifespan:d!=null&&d.lifespan?d.lifespan.toString():d==null?void 0:d.lifespan,permissions:d==null?void 0:d.permissions.join("-")},enableReinitialize:!0,onSubmit:(f,A)=>Pe(f,A)},({errors:f,handleChange:A,isSubmitting:K,values:U})=>t.createElement(s.l0,null,t.createElement(T.Z,{backUrl:"/settings/transfer-tokens",title:{id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"},token:d,setToken:$,canEditInputs:q,canRegenerate:Ee,isSubmitting:K,regenerateUrl:"/admin/transfer/tokens/",onErrorRegenerate:Re}),t.createElement(u.D,null,t.createElement(i.k,{direction:"column",alignItems:"stretch",gap:6},Boolean(d==null?void 0:d.name)&&t.createElement(y.Z,{token:d==null?void 0:d.accessKey,tokenType:o.f}),t.createElement(X,{errors:f,onChange:A,canEditInputs:q,isCreating:D,values:U,transferToken:d}))))))}}}]);

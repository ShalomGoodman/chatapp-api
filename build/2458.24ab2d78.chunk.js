(self.webpackChunkchatapp=self.webpackChunkchatapp||[]).push([[2458],{49699:(M,v,e)=>{"use strict";e.d(v,{Z:()=>x});var t=e(67294),p=e(53979),i=e(11047),o=e(29728),a=e(57993),l=e(85018),g=e(67109),T=e(45697),s=e.n(T),P=e(86896),C=e(30815),n=e(14900);const r=({onRegenerate:E,idToRegenerate:A,backUrl:B,onError:N})=>{const{formatMessage:L}=(0,P.Z)(),[O,U]=(0,t.useState)(!1),{regenerateData:I,isLoadingConfirmation:H}=(0,n.rW)(B,A,E,N),b=async()=>{I(),U(!1)};return t.createElement(t.Fragment,null,t.createElement(o.z,{startIcon:t.createElement(C.Z,null),type:"button",size:"S",variant:"tertiary",onClick:()=>U(!0),name:"regenerate"},L({id:"Settings.tokens.regenerate",defaultMessage:"Regenerate"})),t.createElement(a.QH,{bodyText:{id:"Settings.tokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:t.createElement(C.Z,null),isConfirmButtonLoading:H,isOpen:O,onToggleDialog:()=>U(!1),onConfirm:b,leftButtonText:{id:"Settings.tokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.tokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.tokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};r.defaultProps={onRegenerate(){},onError:void 0},r.propTypes={onRegenerate:s().func,idToRegenerate:s().oneOfType([s().number,s().string]).isRequired,backUrl:s().string.isRequired,onError:s().func};const d=r,m=({title:E,token:A,setToken:B,canEditInputs:N,canRegenerate:L,isSubmitting:O,backUrl:U,regenerateUrl:I,onErrorRegenerate:H})=>{const{formatMessage:b}=(0,P.Z)(),X=Q=>{B({...A,accessKey:Q})};return t.createElement(p.T,{title:(A==null?void 0:A.name)||b(E),primaryAction:N?t.createElement(i.k,{gap:2},L&&(A==null?void 0:A.id)&&t.createElement(d,{backUrl:I,onRegenerate:X,idToRegenerate:A==null?void 0:A.id,onError:H}),t.createElement(o.z,{disabled:O,loading:O,startIcon:t.createElement(l.Z,null),type:"submit",size:"S"},b({id:"global.save",defaultMessage:"Save"}))):L&&(A==null?void 0:A.id)&&t.createElement(d,{onRegenerate:X,idToRegenerate:A==null?void 0:A.id,backUrl:I}),navigationAction:t.createElement(a.rU,{startIcon:t.createElement(g.Z,null),to:U},b({id:"global.back",defaultMessage:"Back"})),ellipsis:!0})};m.propTypes={token:s().shape({id:s().oneOfType([s().number,s().string]),type:s().string,lifespan:s().oneOfType([s().number,s().string]),name:s().string,accessKey:s().string,permissions:s().array,description:s().string,createdAt:s().string}),canEditInputs:s().bool.isRequired,canRegenerate:s().bool.isRequired,setToken:s().func.isRequired,isSubmitting:s().bool.isRequired,backUrl:s().string.isRequired,title:s().shape({id:s().string,label:s().string}).isRequired,regenerateUrl:s().string.isRequired,onErrorRegenerate:s().func},m.defaultProps={token:void 0,onErrorRegenerate:void 0};const x=m},89982:(M,v,e)=>{"use strict";e.d(v,{Z:()=>P});var t=e(67294),p=e(40619),i=e(82562),o=e(75515),a=e(45697),l=e.n(a),g=e(86896),T=e(51352);const s=({token:C,errors:n,values:r,onChange:d,isCreating:m})=>{var x;const{formatMessage:E}=(0,g.Z)();return t.createElement(t.Fragment,null,t.createElement(p.P,{name:"lifespan",label:E({id:"Settings.tokens.form.duration",defaultMessage:"Token duration"}),value:r.lifespan!==null?r.lifespan:"0",error:n.lifespan?E((x=n.lifespan)!=null&&x.id?n.lifespan:{id:n.lifespan,defaultMessage:n.lifespan}):null,onChange:A=>{d({target:{name:"lifespan",value:A}})},required:!0,disabled:!m,placeholder:"Select"},t.createElement(i.W,{value:"604800000"},E({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),t.createElement(i.W,{value:"2592000000"},E({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),t.createElement(i.W,{value:"7776000000"},E({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),t.createElement(i.W,{value:"0"},E({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),t.createElement(o.Z,{variant:"pi",textColor:"neutral600"},!m&&`${E({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,T.IX)(C==null?void 0:C.createdAt,parseInt(r.lifespan,10))}`))};s.propTypes={errors:l().shape({lifespan:l().string}),onChange:l().func.isRequired,values:l().shape({lifespan:l().oneOfType([l().number,l().string])}).isRequired,isCreating:l().bool.isRequired,token:l().shape({id:l().oneOfType([l().number,l().string]),type:l().string,lifespan:l().string,name:l().string,accessKey:l().string,permissions:l().array,description:l().string,createdAt:l().string})},s.defaultProps={errors:{},token:{}};const P=s},81384:(M,v,e)=>{"use strict";e.d(v,{Z:()=>P});var t=e(67294),p=e(12028),i=e(57993),o=e(65186),a=e(69427),l=e(45697),g=e.n(l),T=e(86896);const s=({token:C,tokenType:n})=>{const{formatMessage:r}=(0,T.Z)(),d=(0,i.lm)(),{trackUsage:m}=(0,i.rS)(),{copy:x}=(0,i.VP)(),E=A=>async()=>{await x(A)&&(m("didCopyTokenKey",{tokenType:n}),d({type:"success",message:{id:"Settings.tokens.notification.copied"}}))};return t.createElement(i.Y_,{endAction:C&&t.createElement("span",{style:{alignSelf:"start"}},t.createElement(p.h,{label:r({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),onClick:E(C),noBorder:!0,icon:t.createElement(o.Z,null),style:{padding:0,height:"1rem"}})),title:C||r({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:r(C?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:t.createElement(a.Z,null),iconBackground:"neutral100"})};s.defaultProps={token:null},s.propTypes={token:g().string,tokenType:g().string.isRequired};const P=s},37651:(M,v,e)=>{"use strict";e.d(v,{Z:()=>g});var t=e(67294),p=e(61467),i=e(45697),o=e.n(i),a=e(86896);const l=({errors:T,values:s,onChange:P,canEditInputs:C})=>{var n;const{formatMessage:r}=(0,a.Z)();return t.createElement(p.g,{label:r({id:"Settings.tokens.form.description",defaultMessage:"Description"}),id:"description",error:T.description?r((n=T.description)!=null&&n.id?T.description:{id:T.description,defaultMessage:T.description}):null,onChange:P,disabled:!C},s.description)};l.propTypes={errors:o().shape({description:o().string}),onChange:o().func.isRequired,canEditInputs:o().bool.isRequired,values:o().shape({description:o().string}).isRequired},l.defaultProps={errors:{}};const g=l},72028:(M,v,e)=>{"use strict";e.d(v,{Z:()=>g});var t=e(67294),p=e(16364),i=e(45697),o=e.n(i),a=e(86896);const l=({errors:T,values:s,onChange:P,canEditInputs:C})=>{var n;const{formatMessage:r}=(0,a.Z)();return t.createElement(p.o,{name:"name",error:T.name?r((n=T.name)!=null&&n.id?T.name:{id:T.name,defaultMessage:T.name}):null,label:r({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:P,value:s.name,disabled:!C,required:!0})};l.propTypes={errors:o().shape({name:o().string}),onChange:o().func.isRequired,canEditInputs:o().bool.isRequired,values:o().shape({name:o().string}).isRequired},l.defaultProps={errors:{}};const g=l},32381:(M,v,e)=>{"use strict";e.d(v,{Z:()=>T});var t=e(67294),p=e(40619),i=e(82562),o=e(45697),a=e.n(o),l=e(86896);const g=({name:s,errors:P,values:C,onChange:n,canEditInputs:r,options:d,label:m})=>{var x;const{formatMessage:E}=(0,l.Z)();return t.createElement(p.P,{name:s,label:E({id:m.id,defaultMessage:m.defaultMessage}),value:C&&C[s],error:P[s]?E((x=P[s])!=null&&x.id?P[s]:{id:P[s],defaultMessage:P[s]}):null,onChange:n,placeholder:"Select",required:!0,disabled:!r},d&&d.map(({value:A,label:B})=>t.createElement(i.W,{key:A,value:A},E(B))))};g.propTypes={name:a().string,options:a().arrayOf(a().shape({label:a().shape({id:a().string,defaultMessage:a().string}),value:a().string})),errors:a().shape({type:a().string}),onChange:a().func.isRequired,canEditInputs:a().bool.isRequired,values:a().shape({type:a().string}).isRequired,label:a().shape({id:a().string,defaultMessage:a().string}).isRequired},g.defaultProps={name:"type",errors:{},options:[]};const T=g},81966:(M,v,e)=>{"use strict";e.d(v,{Z:()=>t,f:()=>p});const t="api-token",p="transfer-token"},92458:(M,v,e)=>{"use strict";e.d(v,{Z:()=>Xe});var t=e(67294),p=e(185),i=e(49066),o=e(11047),a=e(57993),l=e(41054),g=e(86896),T=e(88767),s=e(86706),P=e(16550),C=e(45697),n=e.n(C);const r=(0,t.createContext)({}),d=({children:u,...c})=>t.createElement(r.Provider,{value:c},u),m=()=>(0,t.useContext)(r);d.propTypes={children:n().node.isRequired};var x=e(25804),E=e(36364),A=e(81966),B=e(49699),N=e(81384),L=e(41580),O=e(75515),U=e(11276),I=e(67819),H=e(89982),b=e(37651),X=e(72028),Q=e(32381);const q=({errors:u,onChange:c,canEditInputs:y,isCreating:k,values:R,apiToken:S,onDispatch:Z,setHasChangedPermissions:f})=>{const{formatMessage:W}=(0,g.Z)(),V=({target:{value:F}})=>{f(!1),F==="full-access"&&Z({type:"SELECT_ALL_ACTIONS"}),F==="read-only"&&Z({type:"ON_CHANGE_READ_ONLY"})},_=[{value:"read-only",label:{id:"Settings.tokens.types.read-only",defaultMessage:"Read-only"}},{value:"full-access",label:{id:"Settings.tokens.types.full-access",defaultMessage:"Full access"}},{value:"custom",label:{id:"Settings.tokens.types.custom",defaultMessage:"Custom"}}];return t.createElement(L.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(O.Z,{variant:"delta",as:"h2"},W({id:"global.details",defaultMessage:"Details"})),t.createElement(U.r,{gap:5},t.createElement(I.P,{key:"name",col:6,xs:12},t.createElement(X.Z,{errors:u,values:R,canEditInputs:y,onChange:c})),t.createElement(I.P,{key:"description",col:6,xs:12},t.createElement(b.Z,{errors:u,values:R,canEditInputs:y,onChange:c})),t.createElement(I.P,{key:"lifespan",col:6,xs:12},t.createElement(H.Z,{isCreating:k,errors:u,values:R,onChange:c,token:S})),t.createElement(I.P,{key:"type",col:6,xs:12},t.createElement(Q.Z,{values:R,errors:u,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:F=>{V({target:{value:F}}),c({target:{name:"type",value:F}})},options:_,canEditInputs:y})))))};q.propTypes={errors:n().shape({name:n().string,description:n().string,lifespan:n().string,type:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({name:n().string,description:n().string,lifespan:n().oneOfType([n().number,n().string]),type:n().string}).isRequired,isCreating:n().bool.isRequired,apiToken:n().shape({id:n().oneOfType([n().number,n().string]),type:n().string,lifespan:n().string,name:n().string,accessKey:n().string,permissions:n().array,description:n().string,createdAt:n().string}),onDispatch:n().func.isRequired,setHasChangedPermissions:n().func.isRequired},q.defaultProps={errors:{},apiToken:{}};const J=q;var ne=e(53979),ce=e(29728),pe=e(85018);const ee=({apiTokenName:u})=>{const{formatMessage:c}=(0,g.Z)();return(0,a.go)(),t.createElement(p.o,{"aria-busy":"true"},t.createElement(a.SL,{name:"API Tokens"}),t.createElement(ne.T,{primaryAction:t.createElement(ce.z,{disabled:!0,startIcon:t.createElement(pe.Z,null),type:"button",size:"L"},c({id:"global.save",defaultMessage:"Save"})),title:u||c({id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"})}),t.createElement(i.D,null,t.createElement(a.dO,null)))};ee.defaultProps={apiTokenName:null},ee.propTypes={apiTokenName:n().string};const ue=ee;var se=e(35161),ae=e.n(se),oe=e(13217),Oe=e.n(oe),ie=e(88972);const Re=u=>{switch(u){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},De=(0,ie.ZP)(L.x)`
  margin: -1px;
  border-radius: ${({theme:u})=>u.spaces[1]} 0 0 ${({theme:u})=>u.spaces[1]};
`;function ge({route:u}){const{formatMessage:c}=(0,g.Z)(),{method:y,handler:k,path:R}=u,S=R?Oe()(R.split("/")):[],[Z="",f=""]=k?k.split("."):[],W=Re(u.method);return t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},t.createElement(O.Z,{variant:"delta",as:"h3"},c({id:"Settings.apiTokens.createPage.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",t.createElement("span",null,Z),t.createElement(O.Z,{variant:"delta",textColor:"primary600"},".",f)),t.createElement(o.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},t.createElement(De,{background:W.background,borderColor:W.border,padding:2},t.createElement(O.Z,{fontWeight:"bold",textColor:W.text},y)),t.createElement(L.x,{paddingLeft:2,paddingRight:2},ae()(S,V=>t.createElement(O.Z,{key:V,textColor:V.includes(":")?"neutral600":"neutral900"},"/",V)))))}ge.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},ge.propTypes={route:n().shape({handler:n().string,method:n().string,path:n().string})};const Ie=ge,Se=()=>{var u;const{value:{selectedAction:c,routes:y}}=m(),{formatMessage:k}=(0,g.Z)(),R=c==null?void 0:c.split(".")[0];return t.createElement(I.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},c?t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},(u=y[R])==null?void 0:u.map(S=>{var Z,f;return(f=(Z=S.config.auth)==null?void 0:Z.scope)!=null&&f.includes(c)||S.handler===c?t.createElement(Ie,{key:S.handler,route:S}):null})):t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},t.createElement(O.Z,{variant:"delta",as:"h3"},k({id:"Settings.apiTokens.createPage.permissions.header.title",defaultMessage:"Advanced settings"})),t.createElement(O.Z,{as:"p",textColor:"neutral600"},k({id:"Settings.apiTokens.createPage.permissions.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))};var Le=e(48734),ke=e(74756),Be=e(63081),Pe=e(36213),Ue=e(78114),be=e(48403),Ze=e.n(be);const Ae=(0,ie.iv)`
  background: ${u=>u.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,We=(0,ie.ZP)(L.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${u=>u.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${u=>u.isActive&&Ae}
  &:hover {
    ${Ae}
  }
`,Ke=ie.ZP.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:u})=>u.colors.neutral150};
`,me=({controllers:u,label:c,orderNumber:y,disabled:k,onExpanded:R,indexExpandendCollapsedContent:S})=>{const{value:{onChangeSelectAll:Z,onChange:f,selectedActions:W,setSelectedAction:V,selectedAction:_}}=m(),[F,le]=(0,t.useState)(!1),{formatMessage:ve}=(0,g.Z)(),ye=()=>{le(D=>!D),R(y)};(0,t.useEffect)(()=>{S!==null&&S!==y&&F&&le(!1)},[S,y,F]);const te=D=>D===_;return t.createElement(Le.U,{expanded:F,onToggle:ye,variant:y%2?"primary":"secondary"},t.createElement(ke.B,{title:Ze()(c)}),t.createElement(Be.v,null,u==null?void 0:u.map(D=>{const G=D.actions.every(K=>W.includes(K.actionId)),re=D.actions.some(K=>W.includes(K.actionId));return t.createElement(L.x,{key:`${c}.${D==null?void 0:D.controller}`},t.createElement(o.k,{justifyContent:"space-between",alignItems:"center",padding:4},t.createElement(L.x,{paddingRight:4},t.createElement(O.Z,{variant:"sigma",textColor:"neutral600"},D==null?void 0:D.controller)),t.createElement(Ke,null),t.createElement(L.x,{paddingLeft:4},t.createElement(Pe.X,{value:G,indeterminate:!G&&re,onValueChange:()=>{Z({target:{value:[...D.actions]}})},disabled:k},ve({id:"app.utils.select-all",defaultMessage:"Select all"})))),t.createElement(U.r,{gap:4,padding:4},(D==null?void 0:D.actions)&&(D==null?void 0:D.actions.map(K=>t.createElement(I.P,{col:6,key:K.actionId},t.createElement(We,{isActive:te(K.actionId),padding:2,hasRadius:!0},t.createElement(Pe.X,{value:W.includes(K.actionId),name:K.actionId,onValueChange:()=>{f({target:{value:K.actionId}})},disabled:k},K.action),t.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>V({target:{value:K.actionId}}),style:{display:"inline-flex",alignItems:"center"}},t.createElement(Ue.Z,null))))))))})))};me.defaultProps={controllers:[],orderNumber:0,disabled:!1,onExpanded:()=>null,indexExpandendCollapsedContent:null},me.propTypes={controllers:n().array,orderNumber:n().number,label:n().string.isRequired,disabled:n().bool,onExpanded:n().func,indexExpandendCollapsedContent:n().number};const Ne=me,Ee=({section:u,...c})=>{const[y,k]=(0,t.useState)(null),R=S=>k(S);return t.createElement(L.x,{padding:4,background:"neutral0"},u&&u.map((S,Z)=>t.createElement(Ne,{key:S.apiId,label:S.label,controllers:S.controllers,orderNumber:Z,indexExpandendCollapsedContent:y,onExpanded:R,name:S.apiId,...c})))};Ee.defaultProps={section:null},Ee.propTypes={section:n().arrayOf(n().object)};const $e=Ee,je=({...u})=>{const{value:{data:c}}=m(),{formatMessage:y}=(0,g.Z)();return t.createElement(U.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},t.createElement(I.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},t.createElement(O.Z,{variant:"delta",as:"h2"},y({id:"Settings.apiTokens.createPage.permissions.title",defaultMessage:"Permissions"})),t.createElement(O.Z,{as:"p",textColor:"neutral600"},y({id:"Settings.apiTokens.createPage.permissions.description",defaultMessage:"Only actions bound by a route are listed below."}))),(c==null?void 0:c.permissions)&&t.createElement($e,{section:c==null?void 0:c.permissions,...u})),t.createElement(Se,null))},Fe=(0,t.memo)(je);var fe=e(51352);const ze=(u,c=[])=>({...u,selectedAction:null,routes:[],selectedActions:[],data:(0,fe.mk)(c)});var He=e(18172),Ve=e(97019),Ce=e.n(Ve);const _e={data:{},selectedActions:[]},Ge=(u,c)=>(0,He.ZP)(u,y=>{switch(c.type){case"ON_CHANGE":{y.selectedActions.includes(c.value)?Ce()(y.selectedActions,c.value):y.selectedActions.push(c.value);break}case"SELECT_ALL_IN_PERMISSION":{c.value.every(R=>y.selectedActions.includes(R.actionId))?c.value.forEach(R=>{Ce()(y.selectedActions,R.actionId)}):c.value.forEach(R=>{y.selectedActions.push(R.actionId)});break}case"SELECT_ALL_ACTIONS":{y.selectedActions=[...y.data.allActionsIds];break}case"ON_CHANGE_READ_ONLY":{const k=y.data.allActionsIds.filter(R=>R.includes("find")||R.includes("findOne"));y.selectedActions=[...k];break}case"UPDATE_PERMISSIONS_LAYOUT":{y.data=(0,fe.mk)(c.value);break}case"UPDATE_ROUTES":{y.routes={...c.value};break}case"UPDATE_PERMISSIONS":{y.selectedActions=[...c.value];break}case"SET_SELECTED_ACTION":{y.selectedAction=c.value;break}default:return y}}),Ye="Name already taken",Xe=()=>{var u;(0,a.go)();const{formatMessage:c}=(0,g.Z)(),{lockApp:y,unlockApp:k}=(0,a.o1)(),R=(0,a.lm)(),S=(0,P.k6)(),Z=(0,s.v9)(E._),[f,W]=(0,t.useState)((u=S.location.state)!=null&&u.apiToken.accessKey?{...S.location.state.apiToken}:null),{trackUsage:V}=(0,a.rS)(),_=(0,t.useRef)(V),{setCurrentStep:F}=(0,a.c1)(),{allowedActions:{canCreate:le,canUpdate:ve,canRegenerate:ye}}=(0,a.ss)(Z.settings["api-tokens"]),[te,D]=(0,t.useReducer)(Ge,_e,h=>ze(h,{})),{params:{id:G}}=(0,P.$B)("/settings/api-tokens/:id"),{get:re,post:K,put:Qe}=(0,a.kY)(),$=G==="create";(0,T.useQuery)("content-api-permissions",async()=>{const[h,Y]=await Promise.all(["/admin/content-api/permissions","/admin/content-api/routes"].map(async w=>{const{data:j}=await re(w);return j.data}));D({type:"UPDATE_PERMISSIONS_LAYOUT",value:h}),D({type:"UPDATE_ROUTES",value:Y}),f&&((f==null?void 0:f.type)==="read-only"&&D({type:"ON_CHANGE_READ_ONLY"}),(f==null?void 0:f.type)==="full-access"&&D({type:"SELECT_ALL_ACTIONS"}),(f==null?void 0:f.type)==="custom"&&D({type:"UPDATE_PERMISSIONS",value:f==null?void 0:f.permissions}))},{onError(){R({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),(0,t.useEffect)(()=>{_.current($?"didAddTokenFromList":"didEditTokenFromList",{tokenType:A.Z})},[$]);const{status:Je}=(0,T.useQuery)(["api-token",G],async()=>{const{data:{data:h}}=await re(`/admin/api-tokens/${G}`);return W({...h}),(h==null?void 0:h.type)==="read-only"&&D({type:"ON_CHANGE_READ_ONLY"}),(h==null?void 0:h.type)==="full-access"&&D({type:"SELECT_ALL_ACTIONS"}),(h==null?void 0:h.type)==="custom"&&D({type:"UPDATE_PERMISSIONS",value:h==null?void 0:h.permissions}),h},{enabled:!$&&!f,onError(){R({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),we=async(h,Y)=>{var w,j,de,Me,xe;_.current($?"willCreateToken":"willEditToken",{tokenType:A.Z}),y();const tt=h.lifespan&&parseInt(h.lifespan,10)&&h.lifespan!=="0"?parseInt(h.lifespan,10):null;try{const{data:{data:z}}=$?await K("/admin/api-tokens",{...h,lifespan:tt,permissions:h.type==="custom"?te.selectedActions:null}):await Qe(`/admin/api-tokens/${G}`,{name:h.name,description:h.description,type:h.type,permissions:h.type==="custom"?te.selectedActions:null});$&&(S.replace(`/settings/api-tokens/${z.id}`,{apiToken:z}),F("apiTokens.success")),k(),W({...z}),R({type:"success",message:c($?{id:"notification.success.apitokencreated",defaultMessage:"API Token successfully created"}:{id:"notification.success.apitokenedited",defaultMessage:"API Token successfully edited"})}),_.current($?"didCreateToken":"didEditToken",{type:f.type,tokenType:A.Z})}catch(z){const nt=(0,x.Iz)(z.response.data);Y.setErrors(nt),((de=(j=(w=z==null?void 0:z.response)==null?void 0:w.data)==null?void 0:j.error)==null?void 0:de.message)===Ye?R({type:"warning",message:z.response.data.message||"notification.error.tokennamenotunique"}):R({type:"warning",message:((xe=(Me=z==null?void 0:z.response)==null?void 0:Me.data)==null?void 0:xe.message)||"notification.error"}),k()}},[qe,he]=(0,t.useState)(!1),et={...te,onChange:({target:{value:h}})=>{he(!0),D({type:"ON_CHANGE",value:h})},onChangeSelectAll:({target:{value:h}})=>{he(!0),D({type:"SELECT_ALL_IN_PERMISSION",value:h})},setSelectedAction:({target:{value:h}})=>{D({type:"SET_SELECTED_ACTION",value:h})}},Te=ve&&!$||le&&$;return!$&&!f&&Je!=="success"?t.createElement(ue,{apiTokenName:f==null?void 0:f.name}):t.createElement(d,{value:et},t.createElement(p.o,null,t.createElement(a.SL,{name:"API Tokens"}),t.createElement(l.J9,{validationSchema:fe.fK,validateOnChange:!1,initialValues:{name:(f==null?void 0:f.name)||"",description:(f==null?void 0:f.description)||"",type:f==null?void 0:f.type,lifespan:f!=null&&f.lifespan?f.lifespan.toString():f==null?void 0:f.lifespan},enableReinitialize:!0,onSubmit:(h,Y)=>we(h,Y)},({errors:h,handleChange:Y,isSubmitting:w,values:j,setFieldValue:de})=>(qe&&(j==null?void 0:j.type)!=="custom"&&de("type","custom"),t.createElement(a.l0,null,t.createElement(B.Z,{backUrl:"/settings/api-tokens",title:{id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"},token:f,setToken:W,canEditInputs:Te,canRegenerate:ye,isSubmitting:w,regenerateUrl:"/admin/api-tokens/"}),t.createElement(i.D,null,t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:6},Boolean(f==null?void 0:f.name)&&t.createElement(N.Z,{token:f==null?void 0:f.accessKey,tokenType:A.Z}),t.createElement(J,{errors:h,onChange:Y,canEditInputs:Te,isCreating:$,values:j,apiToken:f,onDispatch:D,setHasChangedPermissions:he}),t.createElement(Fe,{disabled:!Te||(j==null?void 0:j.type)==="read-only"||(j==null?void 0:j.type)==="full-access"}))))))))}},51352:(M,v,e)=>{"use strict";e.d(v,{IX:()=>a,fK:()=>s,mk:()=>C});var t=e(66115),p=e(77349),i=e(51991);const a=(n,r,d="en")=>{if(r&&typeof r=="number"){const m=r/24/60/60/1e3;return(0,t.Z)((0,p.Z)(new Date(n),m),"PPP",{locale:i[d]})}return"Unlimited"};var l=e(57993),g=e(87561);const s=g.Ry().shape({name:g.Z_(l.I0.string).max(100).required(l.I0.required),type:g.Z_(l.I0.string).oneOf(["read-only","full-access","custom"]).required(l.I0.required),description:g.Z_().nullable(),lifespan:g.Rx().integer().min(0).nullable().defined(l.I0.required)}),C=n=>{const r={allActionsIds:[],permissions:[]};return r.permissions=Object.keys(n).map(d=>({apiId:d,label:d.split("::")[1],controllers:Object.keys(n[d].controllers).map(m=>({controller:m,actions:n[d].controllers[m].map(x=>{const E=`${d}.${m}.${x}`;return d.includes("api::")&&r.allActionsIds.push(E),{action:x,actionId:E}}).flat()})).flat()})),r}},41848:M=>{function v(e,t,p,i){for(var o=e.length,a=p+(i?1:-1);i?a--:++a<o;)if(t(e[a],a,e))return a;return-1}M.exports=v},42118:(M,v,e)=>{var t=e(41848),p=e(62722),i=e(42351);function o(a,l,g){return l===l?i(a,l,g):t(a,p,g)}M.exports=o},74221:M=>{function v(e,t,p,i){for(var o=p-1,a=e.length;++o<a;)if(i(e[o],t))return o;return-1}M.exports=v},62722:M=>{function v(e){return e!==e}M.exports=v},65464:(M,v,e)=>{var t=e(29932),p=e(42118),i=e(74221),o=e(7518),a=e(278),l=Array.prototype,g=l.splice;function T(s,P,C,n){var r=n?i:p,d=-1,m=P.length,x=s;for(s===P&&(P=a(P)),C&&(x=t(s,o(C)));++d<m;)for(var E=0,A=P[d],B=C?C(A):A;(E=r(x,B,E,n))>-1;)x!==s&&g.call(x,E,1),g.call(s,E,1);return s}M.exports=T},42351:M=>{function v(e,t,p){for(var i=p-1,o=e.length;++i<o;)if(e[i]===t)return i;return-1}M.exports=v},97019:(M,v,e)=>{var t=e(5976),p=e(45604),i=t(p);M.exports=i},45604:(M,v,e)=>{var t=e(65464);function p(i,o){return i&&i.length&&o&&o.length?t(i,o):i}M.exports=p},13217:(M,v,e)=>{var t=e(14259);function p(i){var o=i==null?0:i.length;return o?t(i,1,o):[]}M.exports=p},48734:(M,v,e)=>{"use strict";e.d(v,{U:()=>n,y:()=>P});var t=e(85893),p=e(67294),i=e(88972),o=e(13819),a=e(2504),l=e(75515),g=e(11047),T=e(41580);const s=({theme:r,expanded:d,variant:m,disabled:x,error:E})=>E?`1px solid ${r.colors.danger600} !important`:x?`1px solid ${r.colors.neutral150}`:d?`1px solid ${r.colors.primary600}`:m==="primary"?`1px solid ${r.colors.neutral0}`:`1px solid ${r.colors.neutral100}`,P=(0,i.ZP)(l.Z)``,C=(0,i.ZP)(T.x)`
  border: ${s};

  &:hover:not([aria-disabled='true']) {
    border: 1px solid ${({theme:r})=>r.colors.primary600};

    ${P} {
      color: ${({theme:r,expanded:d})=>d?void 0:r.colors.primary700};
    }

    ${l.Z} {
      color: ${({theme:r,expanded:d})=>d?void 0:r.colors.primary600};
    }

    & > ${g.k} {
      background: ${({theme:r})=>r.colors.primary100};
    }

    [data-strapi-dropdown='true'] {
      background: ${({theme:r})=>r.colors.primary200};
    }
  }
`,n=({children:r,disabled:d=!1,error:m,expanded:x=!1,hasErrorMessage:E=!0,id:A,onToggle:B,toggle:N,size:L="M",variant:O="primary",shadow:U})=>{const I=(0,a.M)(A),H=p.useMemo(()=>({expanded:x,onToggle:B,toggle:N,id:I,size:L,variant:O,disabled:d}),[d,x,I,B,L,N,O]);return(0,t.jsxs)(o.S.Provider,{value:H,children:[(0,t.jsx)(C,{"data-strapi-expanded":x,disabled:d,"aria-disabled":d,expanded:x,hasRadius:!0,variant:O,error:m,shadow:U,children:r}),m&&E&&(0,t.jsx)(T.x,{paddingTop:1,children:(0,t.jsx)(l.Z,{variant:"pi",textColor:"danger600",children:m})})]})}},63081:(M,v,e)=>{"use strict";e.d(v,{v:()=>o});var t=e(85893),p=e(13819),i=e(41580);const o=({children:a,...l})=>{const{expanded:g,id:T}=(0,p.A)();if(!g)return null;const s=`accordion-content-${T}`,P=`accordion-label-${T}`,C=`accordion-desc-${T}`;return(0,t.jsx)(i.x,{role:"region",id:s,"aria-labelledby":P,"aria-describedby":C,...l,children:a})}},13819:(M,v,e)=>{"use strict";e.d(v,{A:()=>i,S:()=>p});var t=e(67294);const p=(0,t.createContext)({disabled:!1,expanded:!1,id:"",size:"M",variant:"primary"}),i=()=>(0,t.useContext)(p)},74756:(M,v,e)=>{"use strict";e.d(v,{B:()=>r});var t=e(85893),p=e(12645),i=e(88972),o=e(48734),a=e(13819);const l=({expanded:d,disabled:m,variant:x})=>{let E="neutral100";return d?E="primary100":m?E="neutral150":x==="primary"&&(E="neutral0"),E};var g=e(39785),T=e(52624),s=e(11047),P=e(75515);const C=(0,i.ZP)(g.A)`
  text-align: left;

  // necessary to make the ellipsis prop work on the title
  > span {
    max-width: 100%;
  }

  svg {
    width: ${14/16}rem;
    height: ${14/16}rem;

    path {
      fill: ${({theme:d,expanded:m})=>m?d.colors.primary600:d.colors.neutral500};
    }
  }
`,n=(0,i.ZP)(s.k)`
  min-height: ${({theme:d,size:m})=>d.sizes.accordions[m]};
  border-radius: ${({theme:d,expanded:m})=>m?`${d.borderRadius} ${d.borderRadius} 0 0`:d.borderRadius};

  &:hover {
    svg {
      path {
        fill: ${({theme:d})=>d.colors.primary600};
      }
    }
  }
`,r=({title:d,description:m,as:x="span",togglePosition:E="right",action:A,...B})=>{const{onToggle:N,toggle:L,expanded:O,id:U,size:I,variant:H,disabled:b}=(0,a.A)(),X=`accordion-content-${U}`,Q=`accordion-label-${U}`,q=`accordion-desc-${U}`,J=I==="M"?6:4,ne=I==="M"?J:J-2,ce=l({expanded:O,disabled:b,variant:H}),pe={as:x,fontWeight:I==="S"?"bold":void 0,id:Q,textColor:O?"primary600":"neutral700",ellipsis:!0,variant:I==="M"?"delta":void 0},ee=O?"primary600":"neutral600",ue=O?"primary200":"neutral200",se=I==="M"?`${32/16}rem`:`${24/16}rem`,ae=()=>{b||(L&&!N?(console.warn('Deprecation warning: Usage of "toggle" prop in Accordion component is deprecated. This is discouraged and will be removed in the next major release. Please use "onToggle" instead'),L()):N&&N())},oe=(0,t.jsx)(s.k,{justifyContent:"center",borderRadius:"50%",height:se,width:se,transform:O?"rotate(180deg)":void 0,"data-strapi-dropdown":!0,"aria-hidden":!0,as:"span",background:ue,cursor:b?"not-allowed":"pointer",onClick:ae,shrink:0,children:(0,t.jsx)(T.J,{as:p.Z,width:I==="M"?`${11/16}rem`:`${8/16}rem`,color:O?"primary600":"neutral600"})});return(0,t.jsx)(n,{paddingBottom:ne,paddingLeft:J,paddingRight:J,paddingTop:ne,background:ce,expanded:O,size:I,justifyContent:"space-between",cursor:b?"not-allowed":"",children:(0,t.jsxs)(s.k,{gap:3,flex:1,maxWidth:"100%",children:[E==="left"&&oe,(0,t.jsx)(C,{onClick:ae,"aria-disabled":b,"aria-expanded":O,"aria-controls":X,"aria-labelledby":Q,"data-strapi-accordion-toggle":!0,expanded:O,type:"button",flex:1,minWidth:0,...B,children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.y,{...pe,children:d}),m&&(0,t.jsx)(P.Z,{as:"p",id:q,textColor:ee,children:m})]})}),E==="right"&&(0,t.jsxs)(s.k,{gap:3,children:[oe,A]}),E==="left"&&A]})})}}}]);

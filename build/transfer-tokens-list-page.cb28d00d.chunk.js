"use strict";(self.webpackChunkchatapp=self.webpackChunkchatapp||[]).push([[9600],{92668:(G,C,t)=>{t.d(C,{Z:()=>j});var e=t(67294),r=t(15234),I=t(79031),m=t(37909),S=t(75515),x=t(11047),l=t(57993),F=t(45697),n=t.n(F),M=t(86896),B=t(16550),$=t(41580),R=t(12028),Q=t(20022);const p=({tokenName:s,onClickDelete:i,tokenType:c})=>{const{formatMessage:E}=(0,M.Z)(),{trackUsage:u}=(0,l.rS)(),[f,g]=(0,e.useState)(!1),L=()=>{g(!1),u("willDeleteToken",{tokenType:c}),i()};return e.createElement($.x,{paddingLeft:1,onClick:d=>d.stopPropagation()},e.createElement(R.h,{onClick:()=>{g(!0)},label:E({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${s}`}),name:"delete",noBorder:!0,icon:e.createElement(Q.Z,null)}),e.createElement(l.QH,{onToggleDialog:()=>g(!1),onConfirm:L,isOpen:f}))};p.propTypes={tokenName:n().string.isRequired,onClickDelete:n().func.isRequired,tokenType:n().string.isRequired};const H=p;var X=t(8934),Y=t(88972);const q={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},K=(0,Y.ZP)(l.rU)`
  svg {
    path {
      fill: ${({theme:s})=>s.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:s})=>s.colors.neutral800};
      }
    }
  }
`,U=({tokenName:s,tokenId:i,buttonType:c,children:E})=>{const{formatMessage:u}=(0,M.Z)(),{location:{pathname:f}}=(0,B.k6)();return e.createElement(K,{to:`${f}/${i}`,title:u(q[c],{target:s})},E)};U.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired,buttonType:n().string,children:n().node.isRequired},U.defaultProps={buttonType:"edit"};const P=U,A=({tokenName:s,tokenId:i})=>e.createElement(P,{tokenName:s,tokenId:i,buttonType:"read"},e.createElement(X.Z,null));A.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};const v=A;var y=t(4585);const V=({tokenName:s,tokenId:i})=>e.createElement(P,{tokenName:s,tokenId:i},e.createElement(y.Z,null));V.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};const b=V,N=({permissions:s,headers:i,contentType:c,isLoading:E,tokens:u,onConfirmDelete:f,tokenType:g})=>{const{canDelete:L,canUpdate:d,canRead:D}=s,O=L||d||D,[{query:Z}]=(0,l.Kx)(),{formatMessage:w}=(0,M.Z)(),[,W]=Z?Z.sort.split(":"):"ASC",{push:z,location:{pathname:J}}=(0,B.k6)(),{trackUsage:a}=(0,l.rS)(),h=u.sort((o,k)=>{const T=o.name.localeCompare(k.name);return W==="DESC"?-T:T});return e.createElement(l.tM,{headers:i,contentType:c,rows:u,withBulkActions:O,isLoading:E,onConfirmDelete:f},e.createElement(r.p,null,h.map(o=>e.createElement(I.Tr,{key:o.id,...(0,l.X7)({fn(){a("willEditTokenFromList",{tokenType:g}),z(`${J}/${o.id}`)},condition:d})},e.createElement(m.Td,{maxWidth:(0,l.Q1)(250)},e.createElement(S.Z,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0},o.name)),e.createElement(m.Td,{maxWidth:(0,l.Q1)(250)},e.createElement(S.Z,{textColor:"neutral800",ellipsis:!0},o.description)),e.createElement(m.Td,null,e.createElement(S.Z,{textColor:"neutral800"},e.createElement(l.ij,{timestamp:new Date(o.createdAt)}))),e.createElement(m.Td,null,o.lastUsedAt&&e.createElement(S.Z,{textColor:"neutral800"},e.createElement(l.ij,{timestamp:new Date(o.lastUsedAt),customIntervals:[{unit:"hours",threshold:1,text:w({id:"Settings.apiTokens.lastHour",defaultMessage:"last hour"})}]}))),O&&e.createElement(m.Td,null,e.createElement(x.k,{justifyContent:"end"},d&&e.createElement(b,{tokenName:o.name,tokenId:o.id}),!d&&D&&e.createElement(v,{tokenName:o.name,tokenId:o.id}),L&&e.createElement(H,{tokenName:o.name,onClickDelete:()=>f(o.id),tokenType:g})))))))};N.propTypes={tokens:n().array,permissions:n().shape({canRead:n().bool,canDelete:n().bool,canUpdate:n().bool}).isRequired,headers:n().arrayOf(n().shape({cellFormatter:n().func,key:n().string.isRequired,metadatas:n().shape({label:n().string.isRequired,sortable:n().bool}).isRequired,name:n().string.isRequired})),contentType:n().string.isRequired,isLoading:n().bool,onConfirmDelete:n().func,tokenType:n().string.isRequired},N.defaultProps={tokens:[],headers:[],isLoading:!1,onConfirmDelete(){}};const j=N},81966:(G,C,t)=>{t.d(C,{Z:()=>e,f:()=>r});const e="api-token",r="transfer-token"},68446:(G,C,t)=>{t.r(C),t.d(C,{default:()=>P});var e=t(67294),r=t(57993),I=t(86706),m=t(36364),S=t(185),x=t(53979),l=t(49066),F=t(29728),n=t(96315),M=t(80129),B=t.n(M),$=t(86896),R=t(88767),Q=t(16550),p=t(81966),H=t(92668);const Y=[{name:"name",key:"name",metadatas:{label:{id:"Settings.tokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.tokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.tokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.tokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],K=()=>{(0,r.go)();const A=(0,R.useQueryClient)(),{formatMessage:v}=(0,$.Z)(),y=(0,r.lm)(),V=(0,I.v9)(m._),{allowedActions:{canCreate:b,canDelete:N,canUpdate:j,canRead:s}}=(0,r.ss)(V.settings["transfer-tokens"]),{push:i}=(0,Q.k6)(),{trackUsage:c}=(0,r.rS)(),{startSection:E}=(0,r.c1)(),u=(0,e.useRef)(E),{get:f,del:g}=(0,r.kY)();(0,e.useEffect)(()=>{u.current&&u.current("transferTokens")},[]),(0,e.useEffect)(()=>{i({search:B().stringify({sort:"name:ASC"},{encode:!1})})},[i]);const L=Y.map(a=>({...a,metadatas:{...a.metadatas,label:v(a.metadatas.label)}})),{data:d,status:D,isFetching:O}=(0,R.useQuery)(["transfer-tokens"],async()=>{c("willAccessTokenList",{tokenType:p.f});const{data:{data:a}}=await f("/admin/transfer/tokens");return c("didAccessTokenList",{number:a.length,tokenType:p.f}),a},{enabled:s,onError(a){var h,o,k,T;console.log("error",a),((T=(k=(o=(h=a==null?void 0:a.response)==null?void 0:h.data)==null?void 0:o.error)==null?void 0:k.details)==null?void 0:T.code)==="INVALID_TOKEN_SALT"?y({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):y({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),Z=s&&(D!=="success"&&D!=="error"||D==="success"&&O),w=(0,R.useMutation)(async a=>{await g(`/admin/transfer/tokens/${a}`)},{async onSuccess(){await A.invalidateQueries(["transfer-tokens"])},onError(a){var h,o,k,T,_,ee;(o=(h=a==null?void 0:a.response)==null?void 0:h.data)!=null&&o.data?y({type:"warning",message:a.response.data.data}):((ee=(_=(T=(k=a==null?void 0:a.response)==null?void 0:k.data)==null?void 0:T.error)==null?void 0:_.details)==null?void 0:ee.code)==="INVALID_TOKEN_SALT"?y({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):y({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),W=s&&d,z=s&&!d&&!b,J=s&&!d&&b;return e.createElement(S.o,{"aria-busy":Z},e.createElement(r.SL,{name:"Transfer Tokens"}),e.createElement(x.T,{title:v({id:"Settings.transferTokens.title",defaultMessage:"Transfer Tokens"}),subtitle:v({id:"Settings.transferTokens.description",defaultMessage:'"List of generated transfer tokens"'}),primaryAction:b?e.createElement(r.Qj,{"data-testid":"create-transfer-token-button",startIcon:e.createElement(n.Z,null),size:"S",onClick:()=>c("willAddTokenFromList",{tokenType:p.f}),to:"/settings/transfer-tokens/create"},v({id:"Settings.transferTokens.create",defaultMessage:"Create new Transfer Token"})):void 0}),e.createElement(l.D,null,!s&&e.createElement(r.ZF,null),W&&e.createElement(H.Z,{permissions:{canRead:s,canDelete:N,canUpdate:j},headers:L,contentType:"trasfer-tokens",rows:d,isLoading:Z,onConfirmDelete:a=>w.mutateAsync(a),tokens:d,tokenType:p.f}),J&&e.createElement(r.dJ,{content:{id:"Settings.transferTokens.addFirstToken",defaultMessage:"Add your first Transfer Token"},action:e.createElement(F.z,{variant:"secondary",startIcon:e.createElement(n.Z,null)},v({id:"Settings.transferTokens.addNewToken",defaultMessage:"Add new Transfer Token"}))}),z&&e.createElement(r.dJ,{content:{id:"Settings.transferTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})))},P=()=>{const A=(0,I.v9)(m._);return e.createElement(r.O4,{permissions:A.settings["transfer-tokens"].main},e.createElement(K,null))}}}]);

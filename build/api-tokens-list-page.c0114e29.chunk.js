"use strict";(self.webpackChunkchatapp=self.webpackChunkchatapp||[]).push([[8056],{92668:(z,E,t)=>{t.d(E,{Z:()=>j});var e=t(67294),o=t(15234),Z=t(79031),m=t(37909),v=t(75515),x=t(11047),r=t(57993),V=t(45697),n=t.n(V),C=t(86896),b=t(16550),O=t(41580),S=t(12028),F=t(20022);const T=({tokenName:a,onClickDelete:i,tokenType:c})=>{const{formatMessage:y}=(0,C.Z)(),{trackUsage:u}=(0,r.rS)(),[p,g]=(0,e.useState)(!1),k=()=>{g(!1),u("willDeleteToken",{tokenType:c}),i()};return e.createElement(O.x,{paddingLeft:1,onClick:d=>d.stopPropagation()},e.createElement(S.h,{onClick:()=>{g(!0)},label:y({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${a}`}),name:"delete",noBorder:!0,icon:e.createElement(F.Z,null)}),e.createElement(r.QH,{onToggleDialog:()=>g(!1),onConfirm:k,isOpen:p}))};T.propTypes={tokenName:n().string.isRequired,onClickDelete:n().func.isRequired,tokenType:n().string.isRequired};const $=T;var J=t(8934),Q=t(88972);const G={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},H=(0,Q.ZP)(r.rU)`
  svg {
    path {
      fill: ${({theme:a})=>a.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:a})=>a.colors.neutral800};
      }
    }
  }
`,P=({tokenName:a,tokenId:i,buttonType:c,children:y})=>{const{formatMessage:u}=(0,C.Z)(),{location:{pathname:p}}=(0,b.k6)();return e.createElement(H,{to:`${p}/${i}`,title:u(G[c],{target:a})},y)};P.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired,buttonType:n().string,children:n().node.isRequired},P.defaultProps={buttonType:"edit"};const I=P,h=({tokenName:a,tokenId:i})=>e.createElement(I,{tokenName:a,tokenId:i,buttonType:"read"},e.createElement(J.Z,null));h.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};const f=h;var D=t(4585);const N=({tokenName:a,tokenId:i})=>e.createElement(I,{tokenName:a,tokenId:i},e.createElement(D.Z,null));N.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};const R=N,M=({permissions:a,headers:i,contentType:c,isLoading:y,tokens:u,onConfirmDelete:p,tokenType:g})=>{const{canDelete:k,canUpdate:d,canRead:A}=a,B=k||d||A,[{query:L}]=(0,r.Kx)(),{formatMessage:W}=(0,C.Z)(),[,Y]=L?L.sort.split(":"):"ASC",{push:K,location:{pathname:w}}=(0,b.k6)(),{trackUsage:l}=(0,r.rS)(),U=u.sort((s,q)=>{const X=s.name.localeCompare(q.name);return Y==="DESC"?-X:X});return e.createElement(r.tM,{headers:i,contentType:c,rows:u,withBulkActions:B,isLoading:y,onConfirmDelete:p},e.createElement(o.p,null,U.map(s=>e.createElement(Z.Tr,{key:s.id,...(0,r.X7)({fn(){l("willEditTokenFromList",{tokenType:g}),K(`${w}/${s.id}`)},condition:d})},e.createElement(m.Td,{maxWidth:(0,r.Q1)(250)},e.createElement(v.Z,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0},s.name)),e.createElement(m.Td,{maxWidth:(0,r.Q1)(250)},e.createElement(v.Z,{textColor:"neutral800",ellipsis:!0},s.description)),e.createElement(m.Td,null,e.createElement(v.Z,{textColor:"neutral800"},e.createElement(r.ij,{timestamp:new Date(s.createdAt)}))),e.createElement(m.Td,null,s.lastUsedAt&&e.createElement(v.Z,{textColor:"neutral800"},e.createElement(r.ij,{timestamp:new Date(s.lastUsedAt),customIntervals:[{unit:"hours",threshold:1,text:W({id:"Settings.apiTokens.lastHour",defaultMessage:"last hour"})}]}))),B&&e.createElement(m.Td,null,e.createElement(x.k,{justifyContent:"end"},d&&e.createElement(R,{tokenName:s.name,tokenId:s.id}),!d&&A&&e.createElement(f,{tokenName:s.name,tokenId:s.id}),k&&e.createElement($,{tokenName:s.name,onClickDelete:()=>p(s.id),tokenType:g})))))))};M.propTypes={tokens:n().array,permissions:n().shape({canRead:n().bool,canDelete:n().bool,canUpdate:n().bool}).isRequired,headers:n().arrayOf(n().shape({cellFormatter:n().func,key:n().string.isRequired,metadatas:n().shape({label:n().string.isRequired,sortable:n().bool}).isRequired,name:n().string.isRequired})),contentType:n().string.isRequired,isLoading:n().bool,onConfirmDelete:n().func,tokenType:n().string.isRequired},M.defaultProps={tokens:[],headers:[],isLoading:!1,onConfirmDelete(){}};const j=M},81966:(z,E,t)=>{t.d(E,{Z:()=>e,f:()=>o});const e="api-token",o="transfer-token"},71362:(z,E,t)=>{t.r(E),t.d(E,{default:()=>I});var e=t(67294),o=t(57993),Z=t(86706),m=t(36364),v=t(185),x=t(53979),r=t(49066),V=t(29728),n=t(96315),C=t(80129),b=t.n(C),O=t(86896),S=t(88767),F=t(16550),T=t(81966),$=t(92668);const Q=[{name:"name",key:"name",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],H=()=>{(0,o.go)();const h=(0,S.useQueryClient)(),{formatMessage:f}=(0,O.Z)(),D=(0,o.lm)(),N=(0,Z.v9)(m._),{allowedActions:{canCreate:R,canDelete:M,canUpdate:j,canRead:a}}=(0,o.ss)(N.settings["api-tokens"]),{push:i}=(0,F.k6)(),{trackUsage:c}=(0,o.rS)(),{startSection:y}=(0,o.c1)(),u=(0,e.useRef)(y),{get:p,del:g}=(0,o.kY)();(0,e.useEffect)(()=>{u.current&&u.current("apiTokens")},[]),(0,e.useEffect)(()=>{i({search:b().stringify({sort:"name:ASC"},{encode:!1})})},[i]);const k=Q.map(l=>({...l,metadatas:{...l.metadatas,label:f(l.metadatas.label)}})),{data:d,status:A,isFetching:B}=(0,S.useQuery)(["api-tokens"],async()=>{c("willAccessTokenList",{tokenType:T.Z});const{data:{data:l}}=await p("/admin/api-tokens");return c("didAccessTokenList",{number:l.length,tokenType:T.Z}),l},{enabled:a,onError(){D({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),L=a&&(A!=="success"&&A!=="error"||A==="success"&&B),W=(0,S.useMutation)(async l=>{await g(`/admin/api-tokens/${l}`)},{async onSuccess(){await h.invalidateQueries(["api-tokens"]),c("didDeleteToken")},onError(l){var U,s;(s=(U=l==null?void 0:l.response)==null?void 0:U.data)!=null&&s.data?D({type:"warning",message:l.response.data.data}):D({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),Y=a&&d,K=a&&!d&&!R,w=a&&!d&&R;return e.createElement(v.o,{"aria-busy":L},e.createElement(o.SL,{name:"API Tokens"}),e.createElement(x.T,{title:f({id:"Settings.apiTokens.title",defaultMessage:"API Tokens"}),subtitle:f({id:"Settings.apiTokens.description",defaultMessage:"List of generated tokens to consume the API"}),primaryAction:R?e.createElement(o.Qj,{"data-testid":"create-api-token-button",startIcon:e.createElement(n.Z,null),size:"S",onClick:()=>c("willAddTokenFromList",{tokenType:T.Z}),to:"/settings/api-tokens/create"},f({id:"Settings.apiTokens.create",defaultMessage:"Create new API Token"})):void 0}),e.createElement(r.D,null,!a&&e.createElement(o.ZF,null),Y&&e.createElement($.Z,{permissions:{canRead:a,canDelete:M,canUpdate:j},headers:k,contentType:"api-tokens",rows:d,isLoading:L,onConfirmDelete:l=>W.mutateAsync(l),tokens:d,tokenType:T.Z}),w&&e.createElement(o.dJ,{content:{id:"Settings.apiTokens.addFirstToken",defaultMessage:"Add your first API Token"},action:e.createElement(V.z,{variant:"secondary",startIcon:e.createElement(n.Z,null)},f({id:"Settings.apiTokens.addNewToken",defaultMessage:"Add new API Token"}))}),K&&e.createElement(o.dJ,{content:{id:"Settings.apiTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})))},I=()=>{const h=(0,Z.v9)(m._);return e.createElement(o.O4,{permissions:h.settings["api-tokens"].main},e.createElement(H,null))}}}]);

"use strict";(self.webpackChunkchatapp=self.webpackChunkchatapp||[]).push([[8936],{36318:(Te,k,t)=>{t.r(k),t.d(k,{default:()=>ie});var e=t(67294),i=t(57993),g=t(86706),S=t(36364),Q=t(29728),w=t(11047),G=t(77197),C=t(75515),U=t(85018),h=t(41054),$=t(36968),K=t.n($),b=t(86896),q=t(88767),_=t(16550),ee=t(92686),te=t(79194),oe=t(7761),T=t(11984),m=t(43390),u=t(38705),se=t(68997),ne=t(85230),a=t(86978),le=t(52258),M=t(3848),ae=t(66578);function re(){var v,I,L;const{formatMessage:n}=(0,b.Z)(),{post:ce}=(0,i.kY)(),{push:ue}=(0,_.k6)(),{formatAPIError:de}=(0,i.So)(),p=(0,g.I0)(),fe=(0,g.v9)(S._),W=(0,i.lm)(),{collectionTypes:ge,singleTypes:me,isLoading:ve}=(0,ee.G)(),{isLoading:A,meta:d,workflows:R}=(0,le.n)(),{clientState:{currentWorkflow:{data:r,isDirty:we}}}=(0,g.v9)(o=>{var l;return(l=o==null?void 0:o[a.sN])!=null?l:M.E}),{allowedActions:{canCreate:he}}=(0,i.ss)(fe.settings["review-workflows"]),[D,f]=e.useState(!1),{isLoading:O,getFeature:pe}=(0,oe.q5)(),[ye,Ee]=e.useState(null),[x,y]=e.useState({}),s=pe("review-workflows"),F=R.flatMap(o=>o.contentTypes),{mutateAsync:ke,isLoading:V}=(0,q.useMutation)(async({workflow:o})=>{const{data:{data:l}}=await ce("/admin/review-workflows/workflows",{data:o});return l},{onSuccess(){W({type:"success",message:{id:"Settings.review-workflows.create.page.notification.success",defaultMessage:"Workflow successfully created"}})}}),X=async()=>{var o,l,Y,Z,z,B,H,N,P;y({});try{const c=await ke({workflow:r});return ue(`/settings/review-workflows/${c.id}`),c}catch(c){return((l=(o=c.response.data)==null?void 0:o.error)==null?void 0:l.name)==="ValidationError"&&((B=(z=(Z=(Y=c.response.data)==null?void 0:Y.error)==null?void 0:Z.details)==null?void 0:z.errors)==null?void 0:B.length)>0&&Ee((P=(N=(H=c.response.data)==null?void 0:H.error)==null?void 0:N.details)==null?void 0:P.errors.reduce((j,J)=>(K()(j,J.path,J.message),j),{})),W({type:"warning",message:de(c)}),null}},Se=async()=>{await X()},Ce=()=>{y({})},E=(0,h.TA)({enableReinitialize:!0,initialErrors:ye,initialValues:r,async onSubmit(){const o=r.contentTypes.some(l=>F.includes(l));s!=null&&s[a.Ef]&&(d==null?void 0:d.workflowCount)>=parseInt(s[a.Ef],10)?f("workflow"):s!=null&&s[a._X]&&r.stages.length>=parseInt(s[a._X],10)?f("stage"):o?y(l=>({...l,hasReassignedContentTypes:!0})):X()},validate(o){return(0,ae.V)({values:o,formatMessage:n})}});return(0,te.v)(a.sN,M.I),e.useEffect(()=>{p((0,T.Js)()),p((0,T.CI)({name:""}))},[p]),e.useEffect(()=>{!A&&!O&&(s!=null&&s[a.Ef]&&(d==null?void 0:d.workflowsTotal)>=parseInt(s[a.Ef],10)?f("workflow"):s!=null&&s[a._X]&&r.stages.length>=parseInt(s[a._X],10)&&f("stage"))},[O,A,s,d==null?void 0:d.workflowsTotal,r.stages.length]),e.createElement(e.Fragment,null,e.createElement(m.lx,null),e.createElement(h.Hy,{value:E},e.createElement(h.l0,{onSubmit:E.handleSubmit},e.createElement(m.h4,{navigationAction:e.createElement(m.eJ,{href:"/settings/review-workflows"}),primaryAction:e.createElement(Q.z,{startIcon:e.createElement(U.Z,null),type:"submit",size:"M",disabled:!we||!he,isLoading:V},n({id:"global.save",defaultMessage:"Save"})),title:n({id:"Settings.review-workflows.create.page.title",defaultMessage:"Create Review Workflow"}),subtitle:n({id:"Settings.review-workflows.page.subtitle",defaultMessage:"{count, plural, one {# stage} other {# stages}}"},{count:(I=(v=r==null?void 0:r.stages)==null?void 0:v.length)!=null?I:0})}),e.createElement(m.fC,null,e.createElement(w.k,{alignItems:"stretch",direction:"column",gap:7},ve?e.createElement(G.a,null,n({id:"Settings.review-workflows.page.isLoading",defaultMessage:"Workflow is loading"})):e.createElement(w.k,{alignItems:"stretch",direction:"column",gap:7},e.createElement(ne.Y,{contentTypes:{collectionTypes:ge,singleTypes:me},workflows:R}),e.createElement(se.U,{stages:(L=E.values)==null?void 0:L.stages})))))),e.createElement(i.QH.Root,{isConfirmButtonLoading:V,isOpen:Object.keys(x).length>0,onToggleDialog:Ce,onConfirm:Se},e.createElement(i.QH.Body,null,e.createElement(w.k,{direction:"column",gap:5},x.hasReassignedContentTypes&&e.createElement(C.Z,{textAlign:"center",variant:"omega"},n({id:"Settings.review-workflows.page.delete.confirm.contentType.body",defaultMessage:"{count} {count, plural, one {content-type} other {content-types}} {count, plural, one {is} other {are}} already mapped to {count, plural, one {another workflow} other {other workflows}}. If you save changes, {count, plural, one {this} other {these}} {count, plural, one {content-type} other {{count} content-types}} will no more be mapped to the {count, plural, one {another workflow} other {other workflows}} and all corresponding information will be removed."},{count:F.filter(o=>r.contentTypes.includes(o)).length})),e.createElement(C.Z,{textAlign:"center",variant:"omega"},n({id:"Settings.review-workflows.page.delete.confirm.confirm",defaultMessage:"Are you sure you want to save?"}))))),e.createElement(u.fC,{isOpen:D==="workflow",onClose:()=>f(!1)},e.createElement(u.Dx,null,n({id:"Settings.review-workflows.create.page.workflows.limit.title",defaultMessage:"You\u2019ve reached the limit of workflows in your plan"})),e.createElement(u.uT,null,n({id:"Settings.review-workflows.create.page.workflows.limit.body",defaultMessage:"Delete a workflow or contact Sales to enable more workflows."}))),e.createElement(u.fC,{isOpen:D==="stage",onClose:()=>f(!1)},e.createElement(u.Dx,null,n({id:"Settings.review-workflows.create.page.stages.limit.title",defaultMessage:"You have reached the limit of stages for this workflow in your plan"})),e.createElement(u.uT,null,n({id:"Settings.review-workflows.create.page.stages.limit.body",defaultMessage:"Try deleting some stages or contact Sales to enable more stages."}))))}function ie(){const v=(0,g.v9)(S._);return e.createElement(i.O4,{permissions:v.settings["review-workflows"].create},e.createElement(re,null))}}}]);

"use strict";(self.webpackChunkchatapp=self.webpackChunkchatapp||[]).push([[5162],{34882:(z,b,t)=>{t.d(b,{Z:()=>de});var e=t(67294),S=t(45421),p=t(11047),O=t(64777),B=t(77197),G=t(65833),x=t(33709),r=t(54580),le=t(63237),oe=t(75515),N=t(26031),Q=t(36213),L=t(92155),Y=t(41054),ce=t(45697),f=t.n(ce),J=t(86896),R=t(88972),ue=t(92686);const m=s=>s.reduce((o,d)=>{const M=d.split(".")[0];return o[M]||(o[M]=[]),o[M].push(d),o},{}),K=(0,R.ZP)(S.w)`
  tbody tr:nth-child(odd) {
    background: ${({theme:s})=>s.colors.neutral100};
  }

  thead th span {
    color: ${({theme:s})=>s.colors.neutral500};
  }

  td,
  th {
    padding-block-start: ${({theme:s})=>s.spaces[3]};
    padding-block-end: ${({theme:s})=>s.spaces[3]};
    width: 10%;
    vertical-align: middle;
    text-align: center;
  }

  tbody tr td:first-child {
    /**
     * Add padding to the start of the first column to avoid the checkbox appearing
     * too close to the edge of the table
     */
    padding-inline-start: ${({theme:s})=>s.spaces[2]};
  }
`,re=s=>{const o=[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"}];return s&&(o.push({id:"app.utils.publish",defaultMessage:"Publish"}),o.push({id:"app.utils.unpublish",defaultMessage:"Unpublish"})),o},q=s=>{const o=["entry.create","entry.update","entry.delete"];return s&&o.push("entry.publish","entry.unpublish"),{entry:o,media:["media.create","media.update","media.delete"]}},ee=e.createContext(),ie=({children:s})=>{const{formatMessage:o}=(0,J.Z)(),{collectionTypes:d,isLoading:M}=(0,ue.G)(),c=e.useMemo(()=>d.some(k=>k.options.draftAndPublish===!0),[d]),U=o({id:"Settings.webhooks.form.events",defaultMessage:"Events"});return e.createElement(ee.Provider,{value:{isDraftAndPublish:c}},e.createElement(p.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(O.Q,{"aria-hidden":!0},U),M&&e.createElement(B.a,null,o({id:"Settings.webhooks.events.isLoading",defaultMessage:"Events loading"})),e.createElement(K,{"aria-label":U},s)))};ie.propTypes={children:f().oneOfType([f().arrayOf(f().node),f().node]).isRequired};const te=({getHeaders:s=re})=>{const{isDraftAndPublish:o}=e.useContext(ee),{formatMessage:d}=(0,J.Z)(),M=s(o);return e.createElement(G.S,null,e.createElement(x.Z,null,e.createElement(r.g,null,e.createElement(le.T,null,d({id:"Settings.webhooks.event.select",defaultMessage:"Select event"}))),M.map(c=>["app.utils.publish","app.utils.unpublish"].includes(c.id)?e.createElement(r.g,{key:c.id,title:d({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"})},e.createElement(oe.Z,{variant:"sigma",textColor:"neutral600"},d(c))):e.createElement(r.g,{key:c.id},e.createElement(oe.Z,{variant:"sigma",textColor:"neutral600"},d(c))))))};te.defaultProps={getHeaders:re},te.propTypes={getHeaders:f().func};const ne=({providedEvents:s})=>{const{isDraftAndPublish:o}=e.useContext(ee),d=s||q(o),{values:M,handleChange:c}=(0,Y.u6)(),U="events",k=M.events,_=[],$=m(k),Z=({target:{name:C,value:u}})=>{let T=new Set(k);u?T.add(C):T.delete(C),c({target:{name:U,value:Array.from(T)}})},V=({target:{name:C,value:u}})=>{let T=new Set(k);u?d[C].forEach(y=>{_.includes(y)||T.add(y)}):d[C].forEach(y=>T.delete(y)),c({target:{name:U,value:Array.from(T)}})};return e.createElement(N.X,null,Object.entries(d).map(([C,u])=>e.createElement(X,{disabledEvents:_,key:C,name:C,events:u,inputValue:$[C],handleSelect:Z,handleSelectAll:V})))};ne.defaultProps={providedEvents:null},ne.propTypes={providedEvents:f().object};const ge=s=>s.replace(/-/g," ").split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1).toLowerCase()).join(" "),X=({disabledEvents:s,name:o,events:d,inputValue:M,handleSelect:c,handleSelectAll:U})=>{const{formatMessage:k}=(0,J.Z)(),_=d.filter(u=>!s.includes(u)),$=M.length>0,Z=M.length===_.length,V=({target:{name:u}})=>{U({target:{name:u,value:!Z}})},C=5;return e.createElement(x.Z,null,e.createElement(r.f,null,e.createElement(Q.X,{indeterminate:$&&!Z,"aria-label":k({id:"global.select-all-entries",defaultMessage:"Select all entries"}),name:o,onChange:V,value:Z},ge(o))),d.map(u=>e.createElement(r.f,{key:u},e.createElement(L.C,{disabled:s.includes(u),"aria-label":u,name:u,value:M.includes(u),onValueChange:T=>c({target:{name:u,value:T}})}))),d.length<C&&e.createElement(r.f,{colSpan:C-d.length}))};X.defaultProps={disabledEvents:[],events:[],inputValue:[],handleSelect(){},handleSelectAll(){}},X.propTypes={disabledEvents:f().array,events:f().array,inputValue:f().array,handleSelect:f().func,handleSelectAll:f().func,name:f().string.isRequired};const de={Root:ie,Headers:te,Body:ne,EventRow:X}},81164:(z,b,t)=>{t.d(b,{Z:()=>Me});var e=t(67294),S=t(185),p=t(57993),O=t(88767),B=t(16550),G=t(92686),x=t(53979),r=t(11047),le=t(29728),oe=t(49066),N=t(41580),Q=t(11276),L=t(67819),Y=t(16364),ce=t(90321),f=t(85018),J=t(67109),R=t(41054),ue=t(45697),m=t.n(ue),K=t(86896),re=t(80902),q=t(34882);function ee(){return e.createElement(q.Z.Root,null,e.createElement(q.Z.Headers,null),e.createElement(q.Z.Body,null))}var ie=t(64777),te=t(39785),ne=t(96315),ge=t(29178),X=t(90608);const de=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],s=({name:n,onChange:a,value:l,...i})=>{const{values:{headers:v}}=(0,R.u6)(),[E,g]=(0,e.useState)(de);(0,e.useEffect)(()=>{g(de.filter(h=>!(v!=null&&v.some(D=>D.key!==l&&D.key===h))))},[v,l]);const I=h=>{a({target:{name:n,value:h}})},P=h=>{g(D=>[...D,h]),I(h)};return e.createElement(ge.XU,{...i,onClear:()=>I(""),onChange:I,onCreateOption:P,placeholder:"",value:l},E.map(h=>e.createElement(X.O,{value:h,key:h},h)))};s.defaultProps={value:void 0},s.propTypes={name:m().string.isRequired,onChange:m().func.isRequired,value:m().string};const o=s,M=()=>{const{formatMessage:n}=(0,K.Z)(),{values:a,errors:l}=(0,R.u6)();return e.createElement(r.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(ie.Q,null,n({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})),e.createElement(N.x,{padding:8,background:"neutral100",hasRadius:!0},e.createElement(R.F2,{validateOnChange:!1,name:"headers",render:({push:i,remove:v})=>e.createElement(Q.r,{gap:4},a.headers.map((E,g)=>{var I,P,h,D,j,w;return e.createElement(e.Fragment,{key:`${g}.${E.key}`},e.createElement(L.P,{col:6},e.createElement(R.gN,{as:o,name:`headers.${g}.key`,"aria-label":`row ${g+1} key`,label:n({id:"Settings.webhooks.key",defaultMessage:"Key"}),error:((P=(I=l.headers)==null?void 0:I[g])==null?void 0:P.key)&&l.headers[g].key})),e.createElement(L.P,{col:6},e.createElement(r.k,{alignItems:"flex-end"},e.createElement(N.x,{style:{flex:1}},e.createElement(R.gN,{as:Y.o,name:`headers.${g}.value`,"aria-label":`row ${g+1} value`,label:n({id:"Settings.webhooks.value",defaultMessage:"Value"}),error:((D=(h=l.headers)==null?void 0:h[g])==null?void 0:D.value)&&l.headers[g].value})),e.createElement(r.k,{paddingLeft:2,style:{alignSelf:"center"},paddingTop:(w=(j=l.headers)==null?void 0:j[g])!=null&&w.value?0:5},e.createElement(p.fG,{disabled:a.headers.length===1,onClick:()=>v(g),label:n({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:g+1})})))))}),e.createElement(L.P,{col:12},e.createElement(te.A,{type:"button",onClick:()=>{i({key:"",value:""})},startIcon:e.createElement(ne.Z,null)},n({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"}))))})))};var c=t(75515),U=t(86647),k=t(70968),_=t(88972);const $=_.ZP.svg(({theme:n,color:a})=>`
  width: ${12/16}rem;
  height: ${12/16}rem;

  path {
    fill: ${n.colors[a]};
  }
`),Z=({isPending:n,statusCode:a})=>{const{formatMessage:l}=(0,K.Z)();return n?e.createElement(r.k,{gap:2,alignItems:"center"},e.createElement($,{as:U.Z}),e.createElement(c.Z,null,l({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"}))):a>=200&&a<300?e.createElement(r.k,{gap:2,alignItems:"center"},e.createElement($,{as:f.Z,color:"success700"}),e.createElement(c.Z,null,l({id:"Settings.webhooks.trigger.success",defaultMessage:"success"}))):a>=300?e.createElement(r.k,{gap:2,alignItems:"center"},e.createElement($,{as:k.Z,color:"danger700"}),e.createElement(c.Z,null,l({id:"Settings.error",defaultMessage:"error"})," ",a)):null};Z.propTypes={isPending:m().bool.isRequired,statusCode:m().number},Z.defaultProps={statusCode:void 0};const V=({statusCode:n,message:a})=>{const{formatMessage:l}=(0,K.Z)();return n>=200&&n<300?e.createElement(r.k,{justifyContent:"flex-end"},e.createElement(c.Z,{textColor:"neutral600",ellipsis:!0},l({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"}))):n>=300?e.createElement(r.k,{justifyContent:"flex-end"},e.createElement(r.k,{maxWidth:(0,p.Q1)(250),justifyContent:"flex-end",title:a},e.createElement(c.Z,{ellipsis:!0,textColor:"neutral600"},a))):null};V.propTypes={statusCode:m().number,message:m().string},V.defaultProps={statusCode:void 0,message:void 0};const C=({onCancel:n})=>{const{formatMessage:a}=(0,K.Z)();return e.createElement(r.k,{justifyContent:"flex-end"},e.createElement("button",{onClick:n,type:"button"},e.createElement(r.k,{gap:2,alignItems:"center"},e.createElement(c.Z,{textColor:"neutral400"},a({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})),e.createElement($,{as:k.Z,color:"neutral400"}))))};C.propTypes={onCancel:m().func.isRequired};const u=({isPending:n,onCancel:a,response:l})=>{const{statusCode:i,message:v}=l,{formatMessage:E}=(0,K.Z)();return e.createElement(N.x,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0},e.createElement(Q.r,{gap:4,style:{alignItems:"center"}},e.createElement(L.P,{col:3},e.createElement(c.Z,null,E({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"}))),e.createElement(L.P,{col:3},e.createElement(Z,{isPending:n,statusCode:i})),e.createElement(L.P,{col:6},n?e.createElement(C,{onCancel:a}):e.createElement(V,{statusCode:i,message:v}))))};u.defaultProps={isPending:!1,onCancel(){},response:{}},u.propTypes={isPending:m().bool,onCancel:m().func,response:m().object};const T=u;var y=t(87561);const he=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,pe=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,ve=({formatMessage:n})=>y.Ry().shape({name:y.Z_().required(n({id:"Settings.webhooks.validation.name.required",defaultMessage:"Name is required"})).matches(he,n({id:"Settings.webhooks.validation.name.regex",defaultMessage:"The name must start with a letter and only contain letters, numbers, spaces and underscores"})),url:y.Z_().required(n({id:"Settings.webhooks.validation.url.required",defaultMessage:"Url is required"})).matches(pe,n({id:"Settings.webhooks.validation.url.regex",defaultMessage:"The value must be a valid Url"})),headers:y.Vo(a=>{let l=y.IX();if(a.length===1){const{key:i,value:v}=a[0];if(!i&&!v)return l}return l.of(y.Ry().shape({key:y.Z_().required(n({id:"Settings.webhooks.validation.key",defaultMessage:"Key is required"})),value:y.Z_().required(n({id:"Settings.webhooks.validation.value",defaultMessage:"Value is required"}))}))}),events:y.IX()}),me=({handleSubmit:n,triggerWebhook:a,isCreating:l,isTriggering:i,triggerResponse:v,data:E})=>{var g,I;const{formatMessage:P}=(0,K.Z)(),[h,D]=(0,e.useState)(!1),j=(0,re.c)(ee,async()=>(await t.e(568).then(t.bind(t,70568))).EventTableEE),w=H=>Object.keys(H).length?Object.entries(H).map(([se,ae])=>({key:se,value:ae})):[{key:"",value:""}],A=(0,R.TA)({initialValues:{name:(E==null?void 0:E.name)||"",url:(E==null?void 0:E.url)||"",headers:w((E==null?void 0:E.headers)||{}),events:(E==null?void 0:E.events)||[]},onSubmit(H,{resetForm:se,setSubmitting:ae}){n(H),se({values:H}),ae(!1)},validationSchema:ve({formatMessage:P}),validateOnChange:!1,validateOnBlur:!1});return j?e.createElement(R.Hy,{value:A},e.createElement(p.l0,{onSubmit:A.handleSubmit},e.createElement(x.T,{primaryAction:e.createElement(r.k,{gap:2},e.createElement(le.z,{onClick:()=>{a(),D(!0)},variant:"tertiary",startIcon:e.createElement(ce.Z,null),disabled:l||i,size:"L"},P({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})),e.createElement(le.z,{startIcon:e.createElement(f.Z,null),type:"submit",size:"L",disabled:!A.dirty,loading:A.isSubmitting},P({id:"global.save",defaultMessage:"Save"}))),title:l?P({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):E==null?void 0:E.name,navigationAction:e.createElement(p.rU,{startIcon:e.createElement(J.Z,null),to:"/settings/webhooks"},P({id:"global.back",defaultMessage:"Back"}))}),e.createElement(oe.D,null,e.createElement(r.k,{direction:"column",alignItems:"stretch",gap:4},h&&e.createElement(T,{isPending:i,response:v,onCancel:()=>D(!1)}),e.createElement(N.x,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0},e.createElement(r.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(Q.r,{gap:6},e.createElement(L.P,{col:6},e.createElement(R.gN,{as:Y.o,name:"name",error:((g=A==null?void 0:A.errors)==null?void 0:g.name)&&A.errors.name,label:P({id:"global.name",defaultMessage:"Name"}),required:!0})),e.createElement(L.P,{col:12},e.createElement(R.gN,{as:Y.o,name:"url",error:((I=A==null?void 0:A.errors)==null?void 0:I.url)&&A.errors.url,label:P({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),required:!0}))),e.createElement(M,null),e.createElement(j,null))))))):null};me.propTypes={data:m().object,handleSubmit:m().func.isRequired,triggerWebhook:m().func.isRequired,isCreating:m().bool.isRequired,isTriggering:m().bool.isRequired,triggerResponse:m().object},me.defaultProps={data:void 0,triggerResponse:void 0};const fe=me,Ee=n=>({...n,headers:n.headers.reduce((a,{key:l,value:i})=>(l!==""&&(a[l]=i),a),{})}),Me=()=>{const{params:{id:n}}=(0,B.$B)("/settings/webhooks/:id"),a=n==="create",{replace:l}=(0,B.k6)(),i=(0,p.lm)(),{formatAPIError:v}=(0,p.So)(),E=(0,O.useQueryClient)(),{isLoading:g}=(0,G.G)(),{put:I,get:P,post:h}=(0,p.kY)(),{isLoading:D,data:j,error:w}=(0,O.useQuery)(["webhooks",n],async()=>{const{data:{data:W}}=await P(`/admin/webhooks/${n}`);return W},{enabled:!a});e.useEffect(()=>{w&&i({type:"warning",message:v(w)})},[w,i,v]);const{isLoading:A,data:H,isIdle:se,mutate:ae}=(0,O.useMutation)(()=>h(`/admin/webhooks/${n}/trigger`)),Ce=()=>ae(null,{onError(W){i({type:"warning",message:v(W)})}}),ye=(0,O.useMutation)(W=>h("/admin/webhooks",W)),Pe=(0,O.useMutation)(({id:W,body:F})=>I(`/admin/webhooks/${W}`,F)),be=async W=>{if(a){ye.mutate(Ee(W),{onSuccess({data:F}){i({type:"success",message:{id:"Settings.webhooks.created"}}),l(`/settings/webhooks/${F.data.id}`)},onError(F){i({type:"warning",message:v(F)})}});return}Pe.mutate({id:n,body:Ee(W)},{onSuccess(){E.invalidateQueries(["webhooks",n]),i({type:"success",message:{id:"notification.form.success.fields"}})},onError(F){i({type:"warning",message:v(F)})}})};return D||g?e.createElement(p.dO,null):e.createElement(S.o,null,e.createElement(p.SL,{name:"Webhooks"}),e.createElement(fe,{data:j,handleSubmit:be,triggerWebhook:Ce,isCreating:a,isTriggering:A,isTriggerIdle:se,triggerResponse:H==null?void 0:H.data.data}))}},71589:(z,b,t)=>{t.r(b),t.d(b,{default:()=>x});var e=t(67294),S=t(57993),p=t(86706),O=t(36364),B=t(81164);const x=()=>{const r=(0,p.v9)(O._);return e.createElement(S.O4,{permissions:r.settings.webhooks.create},e.createElement(B.Z,null))}},10372:(z,b,t)=>{t.r(b),t.d(b,{default:()=>x});var e=t(67294),S=t(57993),p=t(86706),O=t(36364),B=t(81164);const x=()=>{const r=(0,p.v9)(O._);return e.createElement(S.O4,{permissions:r.settings.webhooks.update},e.createElement(B.Z,null))}},90608:(z,b,t)=>{t.d(b,{O:()=>S});var e=t(29178);const S=e.Wx},67109:(z,b,t)=>{t.d(b,{Z:()=>p});var e=t(85893);const S=O=>(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...O,children:(0,e.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),p=S}}]);
